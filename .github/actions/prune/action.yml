name: "Prune Unneeded Files"
description: "Remove locale data, versioned .so files, and strip symbols from the built app tree."
inputs:
  app_root:
    description: "Path to the compiled app root (e.g. build/Pioneer_<id>/Applications/Pioneer)"
    required: true
    type: string

runs:
  using: "composite"
  steps:
    - name: Trim unneeded files
      shell: bash
      run: |
        ROOT="${{ inputs.app_root }}"

        # 1) Remove locale translations
        if [ -d "$ROOT/share/julia/artifacts" ]; then
          find "$ROOT/share/julia/artifacts" -type d -name locale -prune -exec rm -rf {} +
        fi

        # 2) Strip debug symbols
        if [ -d "$ROOT/lib/julia" ]; then
          find "$ROOT/lib/julia" -type f -name '*.so' -exec strip --strip-unneeded {} + || true
        fi

        # 3) Remove man pages
        if [ -d "$ROOT/share/julia/artifacts" ]; then
          find "$ROOT/share/julia/artifacts" -type d -path '*/share/man*' -prune -exec rm -rf {} +
        fi

        # 4) Remove HTML docs
        if [ -d "$ROOT/share/julia/artifacts" ]; then
          find "$ROOT/share/julia/artifacts" -type d -path '*/share/doc*' -prune -exec rm -rf {} +
        fi

        # 5) Remove fontconfig configs & fonts
        [ -d "$ROOT/etc/fonts" ]        && rm -rf "$ROOT/etc/fonts"
        [ -d "$ROOT/share/fontconfig" ] && rm -rf "$ROOT/share/fontconfig"
        find "$ROOT/share/julia/artifacts" -type d -path '*/fonts' -prune -exec rm -rf {} + 2>/dev/null

        # 6) Remove any broken symlinks
        if [ -d "$ROOT/lib/julia" ]; then
          find "$ROOT/lib/julia" -xtype l -delete
        fi
